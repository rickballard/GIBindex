name: costatus-advisory
on:
  pull_request:
    paths:
      - "docs/ops/costatus/**"
jobs:
  advisory:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Show CoStatus (if present)
        run: |
          test -f docs/ops/costatus/SAMPLE.txt && cat docs/ops/costatus/SAMPLE.txt || echo "No SAMPLE.txt"
      - name: Regex check (advisory)
        shell: bash
        run: |
          RE='^[[:space:]]*CoStatus:[[:space:]]*\[CU[[:space:]]+(OK|SOFT|HARD|FATAL)\]\[PU[[:space:]]+(OK|SOFT|HARD|FATAL)\]\[HU[[:space:]]+(OK|SOFT|HARD|FATAL)\]\[WT[[:space:]]+(OK|SOFT|HARD|FATAL)\][[:space:]]+T[+-][0-9]{2}:[0-9]{2}[[:space:]]+Drift[[:space:]]+[+-]?[0-9]+[[:space:]]+[█▓░]{8}([[:space:]].+)?$'
          if test -f docs/ops/costatus/SAMPLE.txt; then
            if grep -P "$RE" docs/ops/costatus/SAMPLE.txt >/dev/null; then
              echo "OK: CoStatus format looks good."
            else
              echo "NOTE: CoStatus format did not match advisory regex."
            fi
          fi
